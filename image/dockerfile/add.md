# ADD 更高階的複製檔案

`ADD` 指令和 `COPY` 的格式和性質基本一致。但是在 `COPY` 基礎上增加了一些功能。

比如 `<源路徑>` 可以是一個 `URL`，這種情況下，Docker 引擎會試圖去下載這個連結的檔案放到 `<目標路徑>` 去。下載後的檔案許可權自動設定為 `600`，如果這並不是想要的許可權，那麼還需要增加額外的一層 `RUN` 進行許可權調整，另外，如果下載的是個壓縮封裝，需要解壓縮，也一樣還需要額外的一層 `RUN` 指令進行解壓縮。所以不如直接使用 `RUN` 指令，然後使用 `wget` 或者 `curl` 工具下載，處理許可權、解壓縮、然後清理無用檔案更合理。因此，這個功能其實並不實用，而且不推薦使用。

如果 `<源路徑>` 為一個 `tar` 壓縮文件的話，壓縮格式為 `gzip`, `bzip2` 以及 `xz` 的情況下，`ADD` 指令將會自動解壓縮這個壓縮文件到 `<目標路徑>` 去。

在某些情況下，這個自動解壓縮的功能非常有用，比如官方映象 `ubuntu` 中：

```docker
FROM scratch
ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /
...
```

但在某些情況下，如果我們真的是希望複製個壓縮文件進去，而不解壓縮，這時就不可以使用 `ADD` 指令了。

在 Docker 官方的 [Dockerfile 最佳實踐文件](../../appendix/best_practices.md) 中要求，儘可能的使用 `COPY`，因為 `COPY` 的語義很明確，就是複製檔案而已，而 `ADD` 則包含了更復雜的功能，其行為也不一定很清晰。最適合使用 `ADD` 的場合，就是所提及的需要自動解壓縮的場合。

另外需要注意的是，`ADD` 指令會令映象建立快取失效，從而可能會令映象建立變得比較緩慢。

因此在 `COPY` 和 `ADD` 指令中選擇的時候，可以遵循這樣的原則，所有的檔案複製均使用 `COPY` 指令，僅在需要自動解壓縮的場合使用 `ADD`。

在使用該指令的時候還可以加上 `--chown=<user>:<group>` 選項來改變檔案的所屬使用者及所屬組。

```docker
ADD --chown=55:mygroup files* /mydir/
ADD --chown=bin files* /mydir/
ADD --chown=1 files* /mydir/
ADD --chown=10:11 files* /mydir/
```
