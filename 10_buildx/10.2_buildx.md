## 10.2 使用 buildx 建立映象

### 10.2.1 使用

Buildx 的使用非常直觀，絕大多數情況下可以替代 `docker build` 指令。

你可以直接使用 `docker buildx build` 指令建立映象。

```bash
$ docker buildx build .
[+] Building 8.4s (23/32)
 => ...
```

Buildx 使用 [BuildKit 引擎](10.1_buildkit.md)進行建立，支援許多新的功能，具體參考 [Buildkit](10.1_buildkit.md) 一節。

#### 使用 `bake`

`docker buildx bake` 是一個高階建立指令，支援從 HCL、JSON 或 Compose 檔案中定義建立目標，實現複雜的流水線建立。

```bash
## 從 Compose 檔案建立所有服務

$ docker buildx bake

## 僅建立指定目標

$ docker buildx bake web
```

#### 生成 SBOM

Buildx 支援在建立時直接生成 SBOM (Software Bill of Materials)，這對於軟體供應鏈安全至關重要。

```bash
$ docker buildx build --sbom=true -t myimage .
```

該指令會在建立結果中包含 SPDX 或 CycloneDX 格式的 SBOM 資料。

> **⚠️ 注意與失敗模式**：
> 要使 SBOM (或其它 attestation 元資料) 成功附著並可見，對底層的儲存格式有前置要求：預設的 classic image store 不支援 manifest list/index 這種存放 attestation 的結構。
> 
> 如果只簡單執行上述指令，你可能會面臨**『指令成功執行，但本地映象中看不到 SBOM』**的體會落差。
> 
> **正確的解決路徑有兩條**：
> 1. 在 Docker 守護程序中啟用 `containerd image store` 屬性（現代 Docker Desktop 預設推薦）。
> 2. 或者使用 `docker-container` driver 的建構式，並直接**加上 `--push` 引數**將產物推送到遠端支援 OCI 的映象倉庫，倉庫會正確儲存這些元資料。

### 10.2.2 官方文件

* https://docs.docker.com/engine/reference/commandline/buildx/
