# Docker æ˜ è±¡

## ä¸€å¥è©±ç†è§£æ˜ è±¡

> **Docker æ˜ è±¡æ˜¯ä¸€å€‹åªè®€çš„æ¨£æ¿ï¼ŒåŒ…å«äº†åŸ·è¡Œæ‡‰ç”¨æ‰€éœ€çš„ä¸€åˆ‡ï¼šç¨‹å¼ç¢¼ã€åŸ·è¡Œæ™‚ã€å‡½å¼åº«ã€ç’°å¢ƒè®Šæ•¸å’Œè¨­å®šæª”æ¡ˆã€‚**

å¦‚æœç”¨ä¸€å€‹é¡æ¯”ï¼š**æ˜ è±¡å°±åƒæ˜¯ä¸€å¼µå…‰ç¢Ÿæˆ– ISO æª”æ¡ˆ**ã€‚ä½ å¯ä»¥ç”¨åŒä¸€å¼µå…‰ç¢Ÿåœ¨ä¸åŒé›»è…¦ä¸Šå®‰è£ç³»çµ±ï¼Œè€Œå…‰ç¢Ÿæœ¬èº«ä¸æœƒè¢«ä¿®æ”¹ã€‚åŒæ¨£ï¼Œä¸€å€‹æ˜ è±¡å¯ä»¥å»ºç«‹å¤šå€‹å®¹å™¨ï¼Œè€Œæ˜ è±¡æœ¬èº«ä¿æŒä¸è®Šã€‚

## æ˜ è±¡èˆ‡ä½œæ¥­ç³»çµ±çš„é—œä¿‚

æˆ‘å€‘éƒ½çŸ¥é“ï¼Œä½œæ¥­ç³»çµ±åˆ†ç‚º**æ ¸å¿ƒ**å’Œ**ä½¿ç”¨è€…ç©ºé–“**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä½¿ç”¨è€…ç©ºé–“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ‡‰ç”¨ç¨‹å¼ã€å·¥å…·ã€å‡½å¼åº«ã€è¨­å®šæª”æ¡ˆ...                       â”‚   â”‚
â”‚  â”‚  ï¼ˆé€™éƒ¨åˆ†è¢«æ‰“åŒ…æˆ Docker æ˜ è±¡ï¼‰                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Linux æ ¸å¿ƒ                             â”‚
â”‚             ï¼ˆå®¹å™¨å…±äº«å®¿ä¸»æ©Ÿçš„æ ¸å¿ƒï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å°æ–¼ Linux è€Œè¨€ï¼Œæ ¸å¿ƒå•Ÿå‹•å¾Œæœƒæ›è¼‰ `root` æª”æ¡ˆç³»çµ±ä¾†æä¾›ä½¿ç”¨è€…ç©ºé–“æ”¯æ´ã€‚**Docker æ˜ è±¡**æœ¬è³ªä¸Šå°±æ˜¯ä¸€å€‹ `root` æª”æ¡ˆç³»çµ±ã€‚

ä¾‹å¦‚ï¼Œå®˜æ–¹æ˜ è±¡ `ubuntu:24.04` åŒ…å«äº†ä¸€å¥—å®Œæ•´çš„ Ubuntu 24.04 æœ€å°ç³»çµ±çš„ root æª”æ¡ˆç³»çµ±â€”â€”ä½†**ä¸åŒ…å« Linux æ ¸å¿ƒ**ï¼ˆå› ç‚ºå®¹å™¨å…±äº«å®¿ä¸»æ©Ÿçš„æ ¸å¿ƒï¼‰ã€‚

## æ˜ è±¡åŒ…å«ä»€éº¼ï¼Ÿ

Docker æ˜ è±¡æ˜¯ä¸€å€‹ç‰¹æ®Šçš„æª”æ¡ˆç³»çµ±ï¼ŒåŒ…å«ï¼š

| å…§å®¹å‹åˆ¥ | ç¯„ä¾‹ |
|---------|------|
| **ç¨‹å¼æª”æ¡ˆ** | æ‡‰ç”¨äºŒé€²ä½æª”æ¡ˆã€Python/Node ç›´è­¯å™¨ |
| **å‡½å¼åº«æª”æ¡ˆ** | libcã€OpenSSLã€å„ç¨®ä¾è³´åº« |
| **è¨­å®šæª”æ¡ˆ** | nginx.confã€my.cnf ç­‰ |
| **ç’°å¢ƒè®Šæ•¸** | PATHã€LANG ç­‰é è¨­å€¼ |
| **å…ƒè³‡æ–™** | å•Ÿå‹•æŒ‡ä»¤ã€æš´éœ²é€£æ¥åŸ ã€è³‡æ–™å·å®šç¾© |

**é—œéµå±¬æ€§**ï¼š
- âœ… æ˜ è±¡æ˜¯**åªè®€**çš„
- âœ… æ˜ è±¡**ä¸åŒ…å«**å‹•æ…‹è³‡æ–™
- âœ… æ˜ è±¡å»ºç«‹å¾Œ**å…§å®¹ä¸æœƒæ”¹è®Š**

## åˆ†å±¤å„²å­˜ï¼šæ˜ è±¡çš„æ ¸å¿ƒè¨­è¨ˆ

### ç‚ºä»€éº¼éœ€è¦åˆ†å±¤ï¼Ÿ

ç­†è€…èªç‚ºï¼Œåˆ†å±¤å„²å­˜æ˜¯ Docker æœ€å·§å¦™çš„è¨­è¨ˆä¹‹ä¸€ã€‚

å‡è¨­ä½ æœ‰ä¸‰å€‹æ‡‰ç”¨ï¼Œéƒ½åŸºæ–¼ Ubuntu åŸ·è¡Œï¼š

```
å‚³çµ±æ–¹å¼ï¼ˆä¸åˆ†å±¤ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App A     â”‚  â”‚   App B     â”‚  â”‚   App C     â”‚
â”‚   Ubuntu    â”‚  â”‚   Ubuntu    â”‚  â”‚   Ubuntu    â”‚
â”‚   500MB     â”‚  â”‚   500MB     â”‚  â”‚   500MB     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                ç¸½è¨ˆï¼š1.5GB âŒ

Docker åˆ†å±¤æ–¹å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App A     â”‚  â”‚   App B     â”‚  â”‚   App C     â”‚
â”‚   50MB      â”‚  â”‚   30MB      â”‚  â”‚   40MB      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     Ubuntu      â”‚
               â”‚  ï¼ˆå…±äº«ï¼‰500MB   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                ç¸½è¨ˆï¼š620MB âœ…
```

### åˆ†å±¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

ç­†è€…ç”¨ä¸€å€‹å¯¦éš›çš„ Dockerfile ä¾†è§£é‡‹åˆ†å±¤ï¼š

```docker
FROM ubuntu:24.04          # ç¬¬ 1 å±¤ï¼šåŸºç¤ç³»çµ±ï¼ˆç´„ 78MBï¼‰
RUN apt-get update         # ç¬¬ 2 å±¤ï¼šæ›´æ–°å¥—ä»¶ç´¢å¼•
RUN apt-get install nginx  # ç¬¬ 3 å±¤ï¼šå®‰è£ nginx
COPY app.conf /etc/nginx/  # ç¬¬ 4 å±¤ï¼šè¤‡è£½è¨­å®šæª”æ¡ˆ
```

å»ºç«‹å¾Œçš„æ˜ è±¡çµæ§‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ 4 å±¤: COPY app.conf (åªè®€)       â”‚  â† æœ€æ–°æ–°å¢çš„å±¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 3 å±¤: nginx å®‰è£æª”æ¡ˆ (åªè®€)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 2 å±¤: apt å¿«å–æ›´æ–° (åªè®€)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ 1 å±¤: Ubuntu åŸºç¤ç³»çµ± (åªè®€)      â”‚  â† åŸºç¤æ˜ è±¡å±¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ¯ä¸€å±¤çš„ç‰¹é»ï¼š
- **åªè®€**ï¼šå»ºç«‹å®Œæˆå¾Œä¸å¯ä¿®æ”¹
- **å¯å…±äº«**ï¼šå¤šå€‹æ˜ è±¡å¯ä»¥å…±äº«ç›¸åŒçš„å±¤
- **æœ‰å¿«å–**ï¼šæœªè®ŠåŒ–çš„å±¤ä¸æœƒé‡æ–°å»ºç«‹

### åˆ†å±¤å„²å­˜çš„"é™·é˜±"

> âš ï¸ **ç­†è€…ç‰¹åˆ¥æé†’**ï¼šç†è§£é€™ä¸€é»å¯ä»¥å¹«ä½ é¿å…å»ºç«‹å‡ºè‡ƒè…«çš„æ˜ è±¡ã€‚

**é—œéµåŸç†**ï¼šæ¯ä¸€å±¤çš„æª”æ¡ˆè®ŠåŒ–æœƒè¢«è¨˜éŒ„ï¼Œä½†**åˆªé™¤æ“ä½œåªæ˜¯æ¨™è¨˜ï¼Œä¸æœƒçœŸæ­£æ¸›å°æ˜ è±¡é«”ç©**ã€‚

```docker
# éŒ¯èª¤ç¤ºç¯„ âŒ
FROM ubuntu:24.04
RUN apt-get update
RUN apt-get install -y build-essential  # å®‰è£ç·¨è­¯å·¥å…·ï¼ˆç´„ 200MBï¼‰
RUN make && make install                  # ç·¨è­¯æ‡‰ç”¨
RUN apt-get remove build-essential        # è©¦åœ–åˆªé™¤ç·¨è­¯å·¥å…·
# çµæœï¼šæ˜ è±¡ä»ç„¶åŒ…å« 200MB çš„ç·¨è­¯å·¥å…·ï¼
```

```docker
# æ­£ç¢ºåšæ³• âœ…
FROM ubuntu:24.04
RUN apt-get update && \
    apt-get install -y build-essential && \
    make && make install && \
    apt-get remove -y build-essential && \
    apt-get autoremove -y && \
    rm -rf /var/lib/apt/lists/*
# åœ¨åŒä¸€å±¤å®Œæˆå®‰è£ã€ä½¿ç”¨ã€æ¸…ç†
```

### æª¢è¦–æ˜ è±¡çš„åˆ†å±¤

```bash
# æª¢è¦–æ˜ è±¡çš„æ­·å²ï¼ˆæ¯å±¤çš„å»ºç«‹è¨˜éŒ„ï¼‰
$ docker history nginx:latest

IMAGE          CREATED       CREATED BY                                      SIZE
a6bd71f48f68   2 weeks ago   CMD ["nginx" "-g" "daemon off;"]                0B
<missing>      2 weeks ago   STOPSIGNAL SIGQUIT                              0B
<missing>      2 weeks ago   EXPOSE map[80/tcp:{}]                           0B
<missing>      2 weeks ago   ENTRYPOINT ["/docker-entrypoint.sh"]            0B
<missing>      2 weeks ago   COPY 30-tune-worker-processes.sh /docker-entâ€¦   4.62kB
...
```

## æ˜ è±¡çš„æ¨™è­˜

Docker æ˜ è±¡æœ‰å¤šç¨®æ¨™è­˜æ–¹å¼ï¼š

### 1. æ˜ è±¡åç¨±å’Œæ¨™ç±¤

æ ¼å¼ï¼š`[å€‰åº«åœ°å€/]å€‰åº«å[:æ¨™ç±¤]`

```bash
# å®Œæ•´æ ¼å¼
registry.example.com/myproject/myapp:v1.2.3

# ç°¡å¯«ï¼ˆä½¿ç”¨ Docker Hubï¼‰
nginx:1.25
ubuntu:24.04

# çœç•¥æ¨™ç±¤ï¼ˆé è¨­ä½¿ç”¨ latestï¼‰
nginx  # ç­‰åŒæ–¼ nginx:latest
```

### 2. æ˜ è±¡ IDï¼ˆContent-Addressableï¼‰

æ¯å€‹æ˜ è±¡æœ‰ä¸€å€‹åŸºæ–¼å…§å®¹è¨ˆç®—çš„å”¯ä¸€ IDï¼š

```bash
$ docker images
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
nginx        latest    a6bd71f48f68   2 weeks ago    187MB
ubuntu       24.04     ca2b0f26964c   3 weeks ago    78.1MB
```

### 3. æ˜ è±¡æ‘˜è¦ï¼ˆDigestï¼‰

æ›´ç²¾ç¢ºçš„æ¨™è­˜ï¼ŒåŸºæ–¼æ˜ è±¡å…§å®¹çš„ SHA256 é›œæ¹Šï¼š

```bash
$ docker images --digests
REPOSITORY  TAG     DIGEST                                                                    IMAGE ID
nginx       latest  sha256:6db391d1c0cfb30588ba0bf72ea999404f2764184d8b8d10d89e8a9c6... a6bd71f48f68
```

> ğŸ’¡ ç­†è€…å»ºè­°ï¼šåœ¨ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨æ˜ è±¡æ‘˜è¦è€Œéæ¨™ç±¤ï¼Œå› ç‚ºæ¨™ç±¤å¯ä»¥è¢«è¦†è“‹ï¼Œä½†æ‘˜è¦æ˜¯ä¸å¯è®Šçš„ã€‚

## æ˜ è±¡çš„ä¾†æº

Docker æ˜ è±¡å¯ä»¥é€éä»¥ä¸‹æ–¹å¼ç²å–ï¼š

| æ–¹å¼ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **å¾ Registry æ‹‰å–** | æœ€å¸¸ç”¨çš„æ–¹å¼ | `docker pull nginx` |
| **å¾ Dockerfile å»ºç«‹** | è‡ªå®šç¾©æ˜ è±¡ | `docker build -t myapp .` |
| **å¾å®¹å™¨é€å‡º** | å„²å­˜å®¹å™¨ç‹€æ…‹ï¼ˆä¸æ¨è–¦ï¼‰ | `docker commit` |
| **å¾æª”æ¡ˆåŒ¯å…¥** | é›¢ç·šå‚³è¼¸ | `docker load < image.tar` |

## æœ¬ç« å°çµ

| æ¦‚å¿µ | è¦é» |
|------|------|
| **æ˜ è±¡æ˜¯ä»€éº¼** | åªè®€çš„æ‡‰ç”¨æ¨£æ¿ï¼ŒåŒ…å«åŸ·è¡Œæ‰€éœ€çš„ä¸€åˆ‡ |
| **åˆ†å±¤å„²å­˜** | å¤šå±¤ç–ŠåŠ ï¼Œå…±äº«åŸºç¤å±¤ï¼Œç¯€çœç©ºé–“ |
| **åªè®€å±¬æ€§** | å»ºç«‹å¾Œä¸å¯ä¿®æ”¹ï¼Œä¿è­‰ä¸€è‡´æ€§ |
| **å±¤çš„é™·é˜±** | åˆªé™¤æ“ä½œåªæ˜¯æ¨™è¨˜ï¼Œä¸æ¸›å°é«”ç© |

ç†è§£äº†æ˜ è±¡ï¼Œæ¥ä¸‹ä¾†è®“æˆ‘å€‘å­¸ç¿’[å®¹å™¨](container.md)â€”â€”æ˜ è±¡çš„åŸ·è¡Œå¯¦ä¾‹ã€‚

## å»¶ä¼¸é–±è®€

- [ç²å–æ˜ è±¡](../image/pull.md)ï¼šå¾ Registry ä¸‹è¼‰æ˜ è±¡
- [ä½¿ç”¨ Dockerfile å®šè£½æ˜ è±¡](../image/build.md)ï¼šå»ºç«‹è‡ªå·±çš„æ˜ è±¡
- [Dockerfile æœ€ä½³å¯¦è¸](../appendix/best_practices.md)ï¼šå»ºç«‹é«˜è³ªé‡æ˜ è±¡çš„æŠ€å·§
- [åº•å±¤å¯¦ç¾ - è¯åˆæª”æ¡ˆç³»çµ±](../underly/ufs.md)ï¼šæ·±å…¥ç†è§£åˆ†å±¤å„²å­˜çš„æŠ€è¡“åŸç†
