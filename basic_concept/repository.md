# Docker Registry

## ä¸€å¥è©±ç†è§£ Registry

> **Docker Registry æ˜¯å„²å­˜å’Œåˆ†ç™¼ Docker æ˜ è±¡çš„æœå‹™ï¼Œé¡ä¼¼æ–¼ç¨‹å¼ç¢¼çš„ GitHub æˆ–å¥—ä»¶ç®¡ç†çš„ npmã€‚**

æ˜ è±¡å»ºç«‹å®Œæˆå¾Œï¼Œå¯ä»¥åœ¨ç•¶å‰æ©Ÿå™¨ä¸ŠåŸ·è¡Œã€‚ä½†å¦‚æœéœ€è¦åœ¨å…¶ä»–ä¼ºæœå™¨ä¸Šä½¿ç”¨é€™å€‹æ˜ è±¡ï¼Œå°±éœ€è¦ä¸€å€‹é›†ä¸­çš„å„²å­˜å’Œåˆ†ç™¼æœå‹™â€”â€”é€™å°±æ˜¯ Docker Registryã€‚

## æ ¸å¿ƒæ¦‚å¿µ

### Registryã€å€‰åº«ã€æ¨™ç±¤çš„é—œä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Docker Registry                             â”‚
â”‚                      ï¼ˆå¦‚ Docker Hubï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Repositoryï¼ˆå€‰åº«ï¼‰: nginx                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚  â”‚ :latest â”‚  â”‚ :1.25   â”‚  â”‚ :1.24   â”‚  â”‚ :alpine â”‚   ...   â”‚   â”‚
â”‚  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚  â”‚  (tag)  â”‚         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Repositoryï¼ˆå€‰åº«ï¼‰: mysql                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚  â”‚  â”‚ :latest â”‚  â”‚ :8.0    â”‚  â”‚ :5.7    â”‚   ...                â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| æ¦‚å¿µ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **Registry** | å„²å­˜æ˜ è±¡çš„æœå‹™ | Docker Hubã€ghcr.io |
| **Repositoryï¼ˆå€‰åº«ï¼‰** | åŒä¸€è»Ÿé«”çš„æ˜ è±¡é›†åˆ | `nginx`ã€`mysql`ã€`mycompany/myapp` |
| **Tagï¼ˆæ¨™ç±¤ï¼‰** | å€‰åº«å…§çš„ç‰ˆæœ¬æ¨™è­˜ | `latest`ã€`1.25`ã€`alpine` |

### æ˜ è±¡çš„å®Œæ•´åç¨±

```
[registryåœ°å€/][ä½¿ç”¨è€…å/]å€‰åº«å[:æ¨™ç±¤]
```

ç¯„ä¾‹ï¼š

```bash
# å®Œæ•´æ ¼å¼
registry.example.com/mycompany/myapp:v1.2.3
â”‚                    â”‚         â”‚     â”‚
â”‚                    â”‚         â”‚     â””â”€â”€ æ¨™ç±¤
â”‚                    â”‚         â””â”€â”€ å€‰åº«å
â”‚                    â””â”€â”€ ä½¿ç”¨è€…å/çµ„ç¹”å
â””â”€â”€ Registry åœ°å€

# Docker Hub å®˜æ–¹æ˜ è±¡ï¼ˆçœç•¥ registry å’Œä½¿ç”¨è€…åï¼‰
nginx:1.25
ubuntu:24.04

# Docker Hub ä½¿ç”¨è€…æ˜ è±¡
jwilder/nginx-proxy:latest

# å…¶ä»– Registry
ghcr.io/username/myapp:v1.0
gcr.io/google-containers/pause:3.6
```

> ğŸ’¡ **ç­†è€…æç¤º**ï¼šå¦‚æœä¸æŒ‡å®š Registry åœ°å€ï¼Œé è¨­ä½¿ç”¨ Docker Hubã€‚å¦‚æœä¸æŒ‡å®šæ¨™ç±¤ï¼Œé è¨­ä½¿ç”¨ `latest`ã€‚

## å…¬å…± Registry æœå‹™

### Docker Hubï¼ˆé è¨­ï¼‰

[Docker Hub](https://hub.docker.com/) æ˜¯æœ€å¤§çš„å…¬å…± Registryï¼Œä¹Ÿæ˜¯ Docker çš„é è¨­ Registryã€‚

**ç‰¹é»**ï¼š
- æ“æœ‰å¤§é‡[å®˜æ–¹æ˜ è±¡](https://hub.docker.com/search?q=&type=image&image_filter=official)ï¼ˆnginxã€mysqlã€redis ç­‰ï¼‰
- å…è²»è³¬æˆ¶å¯ä»¥å»ºç«‹å…¬é–‹å€‰åº«
- ä»˜è²»è³¬æˆ¶æ”¯æ´ç§æœ‰å€‰åº«

```bash
# å¾ Docker Hub æ‹‰å–æ˜ è±¡
$ docker pull nginx              # å®˜æ–¹æ˜ è±¡
$ docker pull bitnami/redis      # ç¬¬ä¸‰æ–¹æ˜ è±¡

# æ¨é€æ˜ è±¡åˆ° Docker Hub
$ docker login
$ docker push username/myapp:v1.0
```

### å…¶ä»–å…¬å…± Registry

| Registry | åœ°å€ | èªªæ˜ |
|----------|------|------|
| **GitHub Container Registry** | ghcr.io | GitHub æä¾›ï¼Œèˆ‡ GitHub Actions æ•´åˆå¥½ |
| **Google Container Registry** | gcr.io | Google Cloud æä¾›ï¼ŒKubernetes æ˜ è±¡å¸¸ç”¨ |
| **Quay.io** | quay.io | Red Hat æä¾› |
| **é˜¿é‡Œé›²å®¹å™¨æ˜ è±¡æœå‹™** | registry.cn-*.aliyuncs.com | åœ‹å…§è¨ªå•å¿« |
| **é¨°è¨Šé›²å®¹å™¨æ˜ è±¡æœå‹™** | ccr.ccs.tencentyun.com | åœ‹å…§è¨ªå•å¿« |

## æ˜ è±¡åŠ é€Ÿå™¨

ç”±æ–¼ç¶²è·¯åŸå› ï¼Œåœ¨åœ‹å…§ç›´æ¥è¨ªå• Docker Hub å¯èƒ½æœƒå¾ˆæ…¢ã€‚å¯ä»¥è¨­å®š**æ˜ è±¡åŠ é€Ÿå™¨**ï¼ˆRegistry Mirrorï¼‰ä¾†åŠ é€Ÿä¸‹è¼‰ã€‚

```json
// /etc/docker/daemon.json
{
  "registry-mirrors": [
    "https://your-accelerator-url"
  ]
}
```

è©³ç´°è¨­å®šæ–¹æ³•è«‹åƒè€ƒ[æ˜ è±¡åŠ é€Ÿå™¨](../install/mirror.md)ç« ç¯€ã€‚

> âš ï¸ **ç­†è€…æé†’**ï¼šæ˜ è±¡åŠ é€Ÿå™¨çš„å¯ç”¨æ€§ç¶“å¸¸è®ŠåŒ–ï¼Œä½¿ç”¨å‰å»ºè­°å…ˆæ¸¬è©¦æ˜¯å¦å¯ç”¨ã€‚

## ç§æœ‰ Registry

å°æ–¼ä¼æ¥­ä½¿ç”¨è€…ï¼Œé€šå¸¸éœ€è¦æ­å»ºç§æœ‰ Registry ä¾†å„²å­˜å…§éƒ¨æ˜ è±¡ã€‚

### å®˜æ–¹ Registry æ˜ è±¡

Docker å®˜æ–¹æä¾›äº† [registry](https://hub.docker.com/_/registry/) æ˜ è±¡ï¼Œå¯ä»¥å¿«é€Ÿæ­å»ºç§æœ‰ Registryï¼š

```bash
# å•Ÿå‹•ä¸€å€‹æœ¬åœ° Registry
$ docker run -d -p 5000:5000 --name registry registry:2

# æ¨é€æ˜ è±¡åˆ°æœ¬åœ° Registry
$ docker tag myapp:v1.0 localhost:5000/myapp:v1.0
$ docker push localhost:5000/myapp:v1.0

# å¾æœ¬åœ° Registry æ‹‰å–
$ docker pull localhost:5000/myapp:v1.0
```

### ä¼æ¥­ç´šè§£æ±ºæ–¹æ¡ˆ

å®˜æ–¹ Registry åŠŸèƒ½è¼ƒç‚ºåŸºç¤ï¼Œä¼æ¥­ç’°å¢ƒå¸¸ç”¨ä»¥ä¸‹æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | ç‰¹é» |
|------|------|
| **[Harbor](https://goharbor.io/)** | CNCF å°ˆæ¡ˆï¼ŒåŠŸèƒ½å…¨é¢ï¼ˆä½¿ç”¨è€…ç®¡ç†ã€æ¼æ´æƒæã€æ˜ è±¡ç°½åï¼‰ |
| **[Nexus Repository](../repository/nexus3_registry.md)** | æ”¯æ´å¤šç¨®è£½å“å‹åˆ¥ï¼ˆDockerã€Mavenã€npm ç­‰ï¼‰ |
| **é›²å» å•†æœå‹™** | é˜¿é‡Œé›² ACRã€é¨°è¨Šé›² TCRã€AWS ECR ç­‰ |

ç­†è€…å»ºè­°ï¼š
- å°åœ˜éšŠï¼šå¯ä»¥å…ˆç”¨å®˜æ–¹ Registryï¼Œå¤ ç”¨å³å¯
- ä¸­å¤§å‹åœ˜éšŠï¼šæ¨è–¦ Harborï¼ŒåŠŸèƒ½å®Œå–„ä¸”é–‹æºå…è²»
- å·²ä½¿ç”¨é›²æœå‹™ï¼šç›´æ¥ç”¨é›²å» å•†çš„ Registry æœå‹™æ›´çœå¿ƒ

## æ˜ è±¡çš„æ¨é€å’Œæ‹‰å–

### å®Œæ•´å·¥ä½œæµç¨‹

```
é–‹ç™¼è€…æ©Ÿå™¨                    Registry                    ç”Ÿç”¢ä¼ºæœå™¨
     â”‚                           â”‚                             â”‚
     â”‚  docker build             â”‚                             â”‚
     â”‚  å»ºç«‹æ˜ è±¡                  â”‚                             â”‚
     â”‚                           â”‚                             â”‚
     â”‚  docker push â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                             â”‚
     â”‚  æ¨é€æ˜ è±¡                  â”‚  å„²å­˜æ˜ è±¡                   â”‚
     â”‚                           â”‚                             â”‚
     â”‚                           â”‚  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ docker pull â”‚
     â”‚                           â”‚                  æ‹‰å–æ˜ è±¡    â”‚
     â”‚                           â”‚                             â”‚
     â”‚                           â”‚                  docker run â”‚
     â”‚                           â”‚                  åŸ·è¡Œå®¹å™¨    â”‚
```

### å¸¸ç”¨æŒ‡ä»¤

```bash
# ç™»å…¥ Registry
$ docker login                      # ç™»å…¥ Docker Hub
$ docker login registry.example.com # ç™»å…¥å…¶ä»– Registry

# æ‹‰å–æ˜ è±¡
$ docker pull nginx:1.25

# æ¨™è¨˜æ˜ è±¡ï¼ˆæº–å‚™æ¨é€ï¼‰
$ docker tag myapp:latest registry.example.com/myteam/myapp:v1.0

# æ¨é€æ˜ è±¡
$ docker push registry.example.com/myteam/myapp:v1.0

# ç™»å‡º
$ docker logout
```

## æ˜ è±¡çš„å®‰å…¨æ€§

### ä½¿ç”¨å®˜æ–¹æ˜ è±¡

Docker Hub çš„[å®˜æ–¹æ˜ è±¡](https://hub.docker.com/search?q=&type=image&image_filter=official)ï¼ˆæ¨™æœ‰ "Official Image" æ¨™è­˜ï¼‰ç¶“é Docker åœ˜éšŠç¨½æ ¸ï¼Œç›¸å°æ›´å®‰å…¨ã€‚

```bash
# å®˜æ–¹æ˜ è±¡ç¯„ä¾‹
nginx          # âœ… å®˜æ–¹
mysql          # âœ… å®˜æ–¹
redis          # âœ… å®˜æ–¹

# ç¬¬ä¸‰æ–¹æ˜ è±¡ï¼ˆéœ€è¦è‡ªè¡Œè©•ä¼°å¯ä¿¡åº¦ï¼‰
bitnami/redis  # âš ï¸ éœ€è¦è©•ä¼°
someuser/myapp # âš ï¸ éœ€è¦è©•ä¼°
```

### æ˜ è±¡ç°½å

ä½¿ç”¨ Docker Content Trust (DCT) é©—è­‰æ˜ è±¡ä¾†æºï¼š

```bash
# å•Ÿç”¨æ˜ è±¡ç°½åé©—è­‰
$ export DOCKER_CONTENT_TRUST=1

# æ­¤å¾Œçš„ pull/push æœƒé©—è­‰ç°½å
$ docker pull nginx:latest
```

### æ¼æ´æƒæ

```bash
# ä½¿ç”¨ Docker Scout æƒææ˜ è±¡æ¼æ´
$ docker scout cves nginx:latest

# ä½¿ç”¨ Trivyï¼ˆé–‹æºå·¥å…·ï¼‰
$ trivy image nginx:latest
```

## æœ¬ç« å°çµ

| æ¦‚å¿µ | è¦é» |
|------|------|
| **Registry** | å„²å­˜å’Œåˆ†ç™¼æ˜ è±¡çš„æœå‹™ |
| **å€‰åº«ï¼ˆRepositoryï¼‰** | åŒä¸€è»Ÿé«”çš„æ˜ è±¡é›†åˆ |
| **æ¨™ç±¤ï¼ˆTagï¼‰** | ç‰ˆæœ¬æ¨™è­˜ï¼Œé è¨­ç‚º latest |
| **Docker Hub** | é è¨­çš„å…¬å…± Registry |
| **ç§æœ‰ Registry** | ä¼æ¥­å…§éƒ¨ä½¿ç”¨ï¼Œæ¨è–¦ Harbor |

ç¾åœ¨ä½ å·²ç¶“ç­è§£äº† Docker çš„ä¸‰å€‹æ ¸å¿ƒæ¦‚å¿µï¼š[æ˜ è±¡](image.md)ã€[å®¹å™¨](container.md)å’Œå€‰åº«ã€‚æ¥ä¸‹ä¾†ï¼Œè®“æˆ‘å€‘é–‹å§‹[å®‰è£ Docker](../install/README.md)ï¼Œå‹•æ‰‹å¯¦è¸ï¼

## å»¶ä¼¸é–±è®€

- [Docker Hub](../repository/dockerhub.md)ï¼šDocker Hub çš„è©³ç´°ä½¿ç”¨
- [ç§æœ‰å€‰åº«](../repository/registry.md)ï¼šæ­å»ºç§æœ‰ Registry
- [ç§æœ‰å€‰åº«é«˜éšè¨­å®š](../repository/registry_auth.md)ï¼šèªè­‰ã€TLS è¨­å®š
- [æ˜ è±¡åŠ é€Ÿå™¨](../install/mirror.md)ï¼šè¨­å®šæ˜ è±¡åŠ é€Ÿ
