# é€²å…¥å®¹å™¨

## ç‚ºä»€éº¼éœ€è¦é€²å…¥å®¹å™¨

ä½¿ç”¨ `-d` å¼•æ•¸å•Ÿå‹•å®¹å™¨å¾Œï¼Œå®¹å™¨åœ¨å¾Œå°åŸ·è¡Œã€‚ä»¥ä¸‹å ´æ™¯éœ€è¦é€²å…¥å®¹å™¨å…§éƒ¨æ“ä½œï¼š

| å ´æ™¯ | ç¯„ä¾‹ |
|------|------|
| **é™¤éŒ¯å•é¡Œ** | æª¢è¦–æ—¥èªŒã€æª¢æŸ¥è¨­å®šã€æ’æŸ¥éŒ¯èª¤ |
| **è‡¨æ™‚æ“ä½œ** | åŸ·è¡Œè³‡æ–™åº«é·ç§»ã€æ¸…ç†å¿«å– |
| **æª¢æŸ¥ç‹€æ…‹** | æª¢è¦–ç¨‹åºã€ç¶²è·¯é€£ç·šã€æª”æ¡ˆç³»çµ± |
| **é–‹ç™¼æ¸¬è©¦** | äº’å‹•å¼æ¸¬è©¦æŒ‡ä»¤ã€é©—è­‰ç’°å¢ƒ |

## å…©ç¨®é€²å…¥æ–¹å¼

Docker æä¾›å…©ç¨®é€²å…¥å®¹å™¨çš„æŒ‡ä»¤ï¼š

| æŒ‡ä»¤ | æ¨è–¦ç¨‹åº¦ | ç‰¹é» |
|------|---------|------|
| `docker exec` | âœ… **æ¨è–¦** | å•Ÿå‹•æ–°é€²ç¨‹ï¼Œé€€å‡ºä¸å½±éŸ¿å®¹å™¨ |
| `docker attach` | âš ï¸ è¬¹æ…ä½¿ç”¨ | é™„åŠ åˆ°ä¸»ç¨‹åºï¼Œé€€å‡ºå¯èƒ½åœæ­¢å®¹å™¨ |

---

## docker execï¼ˆæ¨è–¦ï¼‰

### åŸºæœ¬ç”¨æ³•

```bash
# é€²å…¥å®¹å™¨ä¸¦å•Ÿå‹•äº’å‹•å¼ shell
$ docker exec -it å®¹å™¨å /bin/bash

# æˆ–ä½¿ç”¨ shï¼ˆé©ç”¨æ–¼ Alpine ç­‰ç²¾ç°¡æ˜ è±¡ï¼‰
$ docker exec -it å®¹å™¨å /bin/sh
```

### å¼•æ•¸èªªæ˜

| å¼•æ•¸ | ä½œç”¨ |
|------|------|
| `-i` | ä¿æŒæ¨™æº–è¼¸å…¥é–‹å•Ÿï¼ˆinteractiveï¼‰ |
| `-t` | åˆ†é…å½çµ‚ç«¯ï¼ˆTTYï¼‰ |
| `-it` | å…©è€…çµ„åˆï¼Œç²å¾—å®Œæ•´äº’å‹•é«”é©— |
| `-u` | æŒ‡å®šä½¿ç”¨è€…ï¼ˆå¦‚ `-u root`ï¼‰ |
| `-w` | æŒ‡å®šå·¥ä½œç›®éŒ„ |
| `-e` | è¨­å®šç’°å¢ƒè®Šæ•¸ |

### ç¯„ä¾‹

```bash
# å•Ÿå‹•ä¸€å€‹å¾Œå°å®¹å™¨
$ docker run -dit --name myubuntu ubuntu
69d137adef7a...

# é€²å…¥å®¹å™¨ï¼ˆäº’å‹•å¼ shellï¼‰
$ docker exec -it myubuntu bash
root@69d137adef7a:/# ls
bin  boot  dev  etc  home  lib  ...
root@69d137adef7a:/# exit

# å®¹å™¨ä»åœ¨åŸ·è¡Œï¼
$ docker ps
CONTAINER ID   IMAGE    STATUS         NAMES
69d137adef7a   ubuntu   Up 2 minutes   myubuntu
```

### åŸ·è¡Œå–®æ¢æŒ‡ä»¤

ä¸é€²å…¥äº’å‹•æ¨¡å¼ï¼Œç›´æ¥åŸ·è¡ŒæŒ‡ä»¤ï¼š

```bash
# æª¢è¦–å®¹å™¨å…§ç¨‹åº
$ docker exec myubuntu ps aux

# æª¢è¦–è¨­å®šæª”æ¡ˆ
$ docker exec myubuntu cat /etc/nginx/nginx.conf

# ä»¥ root ä½¿ç”¨è€…åŸ·è¡Œ
$ docker exec -u root myubuntu apt update
```

### åªç”¨ -i ä¸ç”¨ -t çš„å€åˆ¥

```bash
# åªç”¨ -iï¼šå¯ä»¥åŸ·è¡ŒæŒ‡ä»¤ï¼Œä½†æ²’æœ‰æç¤ºç¬¦
$ docker exec -i myubuntu bash
ls           # è¼¸å…¥æŒ‡ä»¤
bin          # è¼¸å‡ºçµæœ
boot
dev
...

# ç”¨ -itï¼šæœ‰å®Œæ•´çš„çµ‚ç«¯é«”é©—
$ docker exec -it myubuntu bash
root@69d137adef7a:/#    # æœ‰æç¤ºç¬¦
```

> ğŸ’¡ é€šå¸¸ä½¿ç”¨ `-it` çµ„åˆã€‚åªæœ‰åœ¨æŒ‡ä»¤ç¢¼ä¸­éœ€è¦é€éé€šé“å‚³å…¥æŒ‡ä»¤æ™‚æ‰åªç”¨ `-i`ã€‚

---

## docker attachï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰

### åŸºæœ¬ç”¨æ³•

```bash
$ docker attach å®¹å™¨å
```

### å·¥ä½œåŸç†

`attach` æœƒé™„åŠ åˆ°å®¹å™¨çš„**ä¸»ç¨‹åº**ï¼ˆPID 1ï¼‰çš„æ¨™æº–è¼¸å…¥è¼¸å‡ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å®¹å™¨                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PID 1: /bin/bash (ä¸»ç¨‹åº)       â”‚â—„â”€â”€â”€â”¼â”€â”€â”€ docker attach é™„åŠ åˆ°é€™è£¡
â”‚  â”‚    â””â”€ ä½ çš„è¼¸å…¥ç›´æ¥å‚³é€åˆ°ä¸»ç¨‹åº    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¯„ä¾‹

```bash
# å•Ÿå‹•å®¹å™¨
$ docker run -dit --name myubuntu ubuntu
243c32535da7...

# é™„åŠ åˆ°å®¹å™¨
$ docker attach myubuntu
root@243c32535da7:/#
```

### âš ï¸ é‡è¦è­¦å‘Š

**å¾ attach æœƒè©±ä¸­è¼¸å…¥ `exit` æˆ–æŒ‰ `Ctrl+D` æœƒå°è‡´å®¹å™¨åœæ­¢ï¼**

```bash
$ docker attach myubuntu
root@243c32535da7:/# exit    # é€™æœƒåœæ­¢å®¹å™¨ï¼

$ docker ps
CONTAINER ID   IMAGE    STATUS                     NAMES
243c32535da7   ubuntu   Exited (0) 2 seconds ago   myubuntu
```

**åŸå› **ï¼šattach é™„åŠ åˆ°ä¸»ç¨‹åºï¼Œé€€å‡ºä¸»ç¨‹åºå°±ç­‰æ–¼é€€å‡ºå®¹å™¨ã€‚

### å®‰å…¨é€€å‡º attach

ä½¿ç”¨ `Ctrl+P` ç„¶å¾Œ `Ctrl+Q` å¯ä»¥å¾ attach æœƒè©±ä¸­**åˆ†é›¢**ï¼Œè€Œä¸åœæ­¢å®¹å™¨ï¼š

```bash
$ docker attach myubuntu
root@243c32535da7:/# 
# æŒ‰ Ctrl+P ç„¶å¾Œ Ctrl+Q
read escape sequence

$ docker ps    # å®¹å™¨ä»åœ¨åŸ·è¡Œ
CONTAINER ID   IMAGE    STATUS         NAMES
243c32535da7   ubuntu   Up 5 minutes   myubuntu
```

---

## exec vs attach å°æ¯”

| å±¬æ€§ | docker exec | docker attach |
|------|-------------|---------------|
| **å·¥ä½œæ–¹å¼** | åœ¨å®¹å™¨å…§å•Ÿå‹•æ–°é€²ç¨‹ | é™„åŠ åˆ°ä¸»ç¨‹åº |
| **é€€å‡ºå½±éŸ¿** | ä¸å½±éŸ¿å®¹å™¨ | å¯èƒ½åœæ­¢å®¹å™¨ |
| **å¤šçµ‚ç«¯** | å¯ä»¥é–‹å¤šå€‹ | å…±äº«åŒä¸€å€‹æœƒè©± |
| **é©ç”¨å ´æ™¯** | é™¤éŒ¯ã€è‡¨æ™‚æ“ä½œ | æª¢è¦–ä¸»ç¨‹åºè¼¸å‡º |
| **æ¨è–¦ç¨‹åº¦** | âœ… æ¨è–¦ | âš ï¸ ç‰¹æ®Šå ´æ™¯ä½¿ç”¨ |

```
docker exec                           docker attach
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å®¹å™¨           â”‚               â”‚      å®¹å™¨           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PID 1: nginx  â”‚  â”‚               â”‚  â”‚ PID 1: bash   â”‚â—„â”€â”¼â”€â”€ é™„åŠ åˆ°ä¸»ç¨‹åº
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ PID 50: bash  â”‚â—„â”€â”¼â”€â”€ æ–°é€²ç¨‹      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é€€å‡º bash ä¸å½±éŸ¿ nginx                 é€€å‡º bash å®¹å™¨åœæ­¢
```

---

## æœ€ä½³å¯¦è¸

### 1. é¦–é¸ docker exec

```bash
# é€²å…¥å®¹å™¨é™¤éŒ¯
$ docker exec -it myapp bash

# æª¢è¦–æ—¥èªŒ
$ docker exec myapp tail -f /var/log/app.log

# åŸ·è¡Œè³‡æ–™åº«é·ç§»
$ docker exec myapp python manage.py migrate
```

### 2. ç”Ÿç”¢ç’°å¢ƒé¿å…é€²å…¥å®¹å™¨

ç­†è€…å»ºè­°ï¼šç”Ÿç”¢ç’°å¢ƒæ‡‰å„˜é‡é¿å…é€²å…¥å®¹å™¨ç›´æ¥æ“ä½œï¼Œè€Œæ˜¯é€éï¼š
- æ—¥èªŒç³»çµ±æª¢è¦–æ—¥èªŒï¼ˆå¦‚ `docker logs` æˆ–é›†ä¸­å¼æ—¥èªŒï¼‰
- ç›£æ§ç³»çµ±æª¢è¦–ç‹€æ…‹
- é‡æ–°éƒ¨ç½²è€Œéæ‰‹å‹•ä¿®æ”¹

### 3. ç„¡ shell æ˜ è±¡çš„è™•ç†

æŸäº›ç²¾ç°¡æ˜ è±¡ï¼ˆå¦‚åŸºæ–¼ `scratch` æˆ– `distroless`ï¼‰æ²’æœ‰ shellï¼š

```bash
# é€™æœƒå¤±æ•—
$ docker exec -it myapp bash
OCI runtime exec failed: exec failed: unable to start container process: exec: "bash": executable file not found

# è§£æ±ºæ–¹æ¡ˆï¼šä½¿ç”¨é™¤éŒ¯å®¹å™¨ï¼ˆDocker Desktop æˆ– Kubernetes debugï¼‰
$ docker debug myapp
```

---

## å¸¸è¦‹å•é¡Œ

### Q: exec é€²å…¥å¾Œçœ‹ä¸åˆ°å…¶ä»–çµ‚ç«¯çš„æ“ä½œ

é€™æ˜¯æ­£å¸¸çš„ã€‚exec å•Ÿå‹•çš„æ˜¯ç¨ç«‹ç¨‹åºï¼Œå¤šå€‹ exec æœƒè©±äº’ä¸å½±éŸ¿ã€‚

### Q: å®¹å™¨æ²’æœ‰ bash

å˜—è©¦ä½¿ç”¨ shï¼š

```bash
$ docker exec -it myapp /bin/sh
```

### Q: éœ€è¦ root è¨±å¯æ¬Š

```bash
$ docker exec -u root -it myapp bash
```

---

## æœ¬ç« å°çµ

| éœ€æ±‚ | æ¨è–¦æŒ‡ä»¤ |
|------|---------|
| é€²å…¥å®¹å™¨é™¤éŒ¯ | `docker exec -it å®¹å™¨å bash` |
| åŸ·è¡Œå–®æ¢æŒ‡ä»¤ | `docker exec å®¹å™¨å æŒ‡ä»¤` |
| æª¢è¦–ä¸»ç¨‹åºè¼¸å‡º | `docker attach å®¹å™¨å`ï¼ˆæ…ç”¨ï¼‰ |

## å»¶ä¼¸é–±è®€

- [å¾Œå°åŸ·è¡Œ](daemon.md)ï¼šç†è§£å®¹å™¨ä¸»ç¨‹åº
- [æª¢è¦–å®¹å™¨](ls.md)ï¼šåˆ—å‡ºå’Œéæ¿¾å®¹å™¨
- [å®¹å™¨æ—¥èªŒ](logs.md)ï¼šæª¢è¦–å®¹å™¨è¼¸å‡º
