## 5.6 åˆªé™¤å®¹å™¨

éš¨è‘—å®¹å™¨çš„å»ºç«‹å’Œåœæ­¢ï¼Œç³»çµ±ä¸­æœƒç©ç´¯å¤§é‡çš„å®¹å™¨ã€‚æœ¬ç¯€å°‡ä»‹ç´¹å¦‚ä½•åˆªé™¤ä¸å†éœ€è¦çš„å®¹å™¨ï¼Œä»¥åŠå¦‚ä½•æ¸…ç†æ‰€æœ‰åœæ­¢çš„å®¹å™¨ã€‚

### åŸºæœ¬ç”¨æ³•

ä½¿ç”¨ `docker rm` åˆªé™¤å·²åœæ­¢çš„å®¹å™¨ï¼š

```bash
$ docker rm å®¹å™¨åæˆ–ID
```

> ğŸ’¡ `docker rm` æ˜¯ `docker container rm` çš„ç°¡å¯«ï¼Œå…©è€…ç­‰æ•ˆã€‚

---

### åˆªé™¤é¸é …

| é¸é … | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| ç„¡å¼•æ•¸ | åˆªé™¤å·²åœæ­¢çš„å®¹å™¨ | `docker rm mycontainer` |
| `-f` | å¼·åˆ¶åˆªé™¤åŸ·è¡Œä¸­çš„å®¹å™¨ | `docker rm -f mycontainer` |
| `-v` | åŒæ™‚åˆªé™¤é—œè¯çš„åŒ¿åå· | `docker rm -v mycontainer` |

#### åˆªé™¤å·²åœæ­¢çš„å®¹å™¨

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker rm mycontainer
mycontainer
```

#### å¼·åˆ¶åˆªé™¤åŸ·è¡Œä¸­çš„å®¹å™¨

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## ä¸åŠ  -f æœƒå ±éŒ¯

$ docker rm running_container
Error: cannot remove running container

## åŠ  -f å¼·åˆ¶åˆªé™¤

$ docker rm -f running_container
running_container
```

> âš ï¸ å¼·åˆ¶åˆªé™¤æœƒå‘å®¹å™¨å‚³é€ SIGKILL è¨Šè™Ÿï¼Œå¯èƒ½å°è‡´è³‡æ–™ä¸Ÿå¤±ã€‚å»ºè­°å…ˆ `docker stop` å„ªé›…åœæ­¢ã€‚

#### åˆªé™¤å®¹å™¨åŠå…¶è³‡æ–™å·

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆªé™¤å®¹å™¨æ™‚åŒæ™‚åˆªé™¤å…¶åŒ¿åå·

$ docker rm -v mycontainer
```

> æ³¨æ„ï¼šåªåˆªé™¤åŒ¿åå·ï¼Œå‘½åå·ä¸æœƒè¢«åˆªé™¤ã€‚

---

### æ‰¹æ¬¡åˆªé™¤

#### åˆªé™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## æ–¹å¼ä¸€ï¼šä½¿ç”¨ prune æŒ‡ä»¤ï¼ˆæ¨è–¦ï¼‰

$ docker container prune

WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
Deleted Containers:
abc123...
def456...
Total reclaimed space: 150MB

## æ–¹å¼äºŒï¼šä¸æç¤ºç¢ºèª

$ docker container prune -f
```

#### åˆªé™¤æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åŸ·è¡Œä¸­çš„ï¼‰

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## å…ˆåœæ­¢æ‰€æœ‰å®¹å™¨ï¼Œå†åˆªé™¤

$ docker stop $(docker ps -q)
$ docker rm $(docker ps -aq)

## æˆ–è€…ç›´æ¥å¼·åˆ¶åˆªé™¤

$ docker rm -f $(docker ps -aq)
```

#### æŒ‰æ¢ä»¶åˆªé™¤

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆªé™¤æ‰€æœ‰å·²é€€å‡ºçš„å®¹å™¨

$ docker rm $(docker ps -aq -f status=exited)

## åˆªé™¤åç¨±åŒ…å« "test" çš„å®¹å™¨

$ docker rm $(docker ps -aq -f name=test)

## åˆªé™¤ 24 å°æ™‚å‰å»ºç«‹çš„å®¹å™¨

$ docker container prune --filter "until=24h"
```

---

### å¸¸ç”¨éæ¿¾æ¢ä»¶

`docker ps` çš„éæ¿¾æ¢ä»¶å¯ä»¥é…åˆ `rm` ä½¿ç”¨ï¼š

| éæ¿¾æ¢ä»¶ | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|
| `status=exited` | å·²é€€å‡ºçš„å®¹å™¨ | `-f status=exited` |
| `status=created` | å·²å»ºç«‹æœªå•Ÿå‹• | `-f status=created` |
| `name=xxx` | åç¨±å°æ‡‰ | `-f name=myapp` |
| `ancestor=xxx` | åŸºæ–¼æŸæ˜ è±¡å»ºç«‹ | `-f ancestor=nginx` |
| `before=xxx` | åœ¨æŸå®¹å™¨ä¹‹å‰å»ºç«‹ | `-f before=mycontainer` |
| `since=xxx` | åœ¨æŸå®¹å™¨ä¹‹å¾Œå»ºç«‹ | `-f since=mycontainer` |

#### ç¯„ä¾‹

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆªé™¤æ‰€æœ‰åŸºæ–¼ nginx æ˜ è±¡çš„å®¹å™¨

$ docker rm $(docker ps -aq -f ancestor=nginx)

## åˆªé™¤æ‰€æœ‰å»ºç«‹å¾Œæœªå•Ÿå‹•çš„å®¹å™¨

$ docker rm $(docker ps -aq -f status=created)
```

---

### å®¹å™¨èˆ‡æ˜ è±¡çš„ä¾è³´é—œä¿‚

> æœ‰å®¹å™¨ä¾è³´çš„æ˜ è±¡ç„¡æ³•åˆªé™¤ã€‚

```bash
## å˜—è©¦åˆªé™¤æœ‰å®¹å™¨ä¾è³´çš„æ˜ è±¡

$ docker image rm nginx
Error: image is being used by stopped container abc123

## éœ€è¦å…ˆåˆªé™¤ä¾è³´è©²æ˜ è±¡çš„å®¹å™¨

$ docker rm abc123
$ docker image rm nginx
```

---

### æ¸…ç†ç­–ç•¥å»ºè­°

#### é–‹ç™¼ç’°å¢ƒ

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## å®šæœŸæ¸…ç†å·²åœæ­¢çš„å®¹å™¨

$ docker container prune -f

## ä¸€éµæ¸…ç†æ‰€æœ‰æœªä½¿ç”¨è³‡æº

$ docker system prune -f
```

#### ç”Ÿç”¢ç’°å¢ƒ

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## ä½¿ç”¨ --rm å¼•æ•¸åŸ·è¡Œè‡¨æ™‚å®¹å™¨

$ docker run --rm ubuntu echo "Hello"
## å®¹å™¨é€€å‡ºå¾Œè‡ªå‹•åˆªé™¤

## å®šæœŸæ¸…ç†ï¼ˆè¨­å®šä¿ç•™æ™‚é–“ï¼‰

$ docker container prune --filter "until=168h"  # ä¿ç•™ 7 å¤©å…§çš„
```

#### å®Œæ•´æ¸…ç†æŒ‡ä»¤ç¢¼

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
#!/bin/bash
## cleanup.sh - Docker è³‡æºæ¸…ç†æŒ‡ä»¤ç¢¼

echo "æ¸…ç†å·²åœæ­¢çš„å®¹å™¨..."
docker container prune -f

echo "æ¸…ç†æœªä½¿ç”¨çš„æ˜ è±¡..."
docker image prune -f

echo "æ¸…ç†æœªä½¿ç”¨çš„è³‡æ–™å·..."
docker volume prune -f

echo "æ¸…ç†æœªä½¿ç”¨çš„ç¶²è·¯..."
docker network prune -f

echo "æ¸…ç†å®Œæˆï¼"
docker system df
```

---

### å¸¸è¦‹å•é¡Œ

#### Q: å®¹å™¨ç„¡æ³•åˆªé™¤

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
Error: container is running
```

è§£æ±ºï¼šå…ˆåœæ­¢å®¹å™¨ï¼Œæˆ–ä½¿ç”¨ `-f` å¼·åˆ¶åˆªé™¤

```bash
$ docker stop mycontainer
$ docker rm mycontainer
## æˆ–

$ docker rm -f mycontainer
```

#### Q: åˆªé™¤å¾Œç£ç¢Ÿç©ºé–“æ²’é‡‹æ”¾

å¯èƒ½åŸå› ï¼š
1. å®¹å™¨çš„è³‡æ–™å·æœªåˆªé™¤ï¼ˆä½¿ç”¨ `-v` å¼•æ•¸ï¼‰
2. æ˜ è±¡æœªåˆªé™¤
3. å»ºç«‹å¿«å–æœªæ¸…ç†

è§£æ±ºï¼š

```bash
## æª¢è¦–ç©ºé–“ä½”ç”¨

$ docker system df

## å®Œæ•´æ¸…ç†

$ docker system prune -a --volumes
```

---

### æœ¬ç« å°çµ

| æ“ä½œ | æŒ‡ä»¤ |
|------|------|
| åˆªé™¤å·²åœæ­¢å®¹å™¨ | `docker rm å®¹å™¨å` |
| å¼·åˆ¶åˆªé™¤åŸ·è¡Œä¸­å®¹å™¨ | `docker rm -f å®¹å™¨å` |
| åˆªé™¤å®¹å™¨åŠåŒ¿åå· | `docker rm -v å®¹å™¨å` |
| æ¸…ç†æ‰€æœ‰å·²åœæ­¢å®¹å™¨ | `docker container prune` |
| åˆªé™¤æ‰€æœ‰å®¹å™¨ | `docker rm -f $(docker ps -aq)` |

### å»¶ä¼¸é–±è®€

- [çµ‚æ­¢å®¹å™¨](5.3_stop.md)ï¼šå„ªé›…åœæ­¢å®¹å™¨
- [åˆªé™¤æ˜ è±¡](../04_image/4.3_rm.md)ï¼šæ¸…ç†æ˜ è±¡
- [è³‡æ–™å·](../08_data_network/data/volume.md)ï¼šè³‡æ–™å·ç®¡ç†
