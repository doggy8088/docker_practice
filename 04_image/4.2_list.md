## 4.2 åˆ—å‡ºæ˜ è±¡

## åˆ—å‡ºæ˜ è±¡

åœ¨ä¸‹è¼‰äº†æ˜ è±¡å¾Œï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `docker image ls` æŒ‡ä»¤åˆ—å‡ºæœ¬åœ°ä¸»æ©Ÿä¸Šçš„æ˜ è±¡ã€‚

### åŸºæœ¬ç”¨æ³•

æª¢è¦–æœ¬åœ°å·²ä¸‹è¼‰çš„æ˜ è±¡ï¼š

```bash
$ docker image ls
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
redis        latest    5f515359c7f8   5 days ago     183MB
nginx        latest    05a60462f8ba   5 days ago     181MB
ubuntu       24.04     329ed837d508   3 days ago     78MB
ubuntu       noble     329ed837d508   3 days ago     78MB
```

> ğŸ’¡ `docker images` æ˜¯ `docker image ls` çš„ç°¡å¯«ï¼Œå…©è€…ç­‰æ•ˆã€‚

---

### è¼¸å‡ºæ¬„ä½èªªæ˜

`docker image ls` æŒ‡ä»¤é è¨­è¼¸å‡ºçš„æ¸…å–®åŒ…å«å€‰åº«åã€æ¨™ç±¤ã€æ˜ è±¡ IDã€å»ºç«‹æ™‚é–“å’Œä½”ç”¨ç©ºé–“ç­‰è¨Šæ¯ã€‚

| æ¬„ä½ | èªªæ˜ |
|------|------|
| **REPOSITORY** | å€‰åº«å |
| **TAG** | æ¨™ç±¤ï¼ˆç‰ˆæœ¬ï¼‰ |
| **IMAGE ID** | æ˜ è±¡å”¯ä¸€æ¨™è­˜ï¼ˆçŸ­ IDï¼Œå‰ 12 ä½ï¼‰ |
| **CREATED** | å»ºç«‹æ™‚é–“ |
| **SIZE** | æœ¬åœ°ä½”ç”¨ç©ºé–“ |

#### åŒä¸€æ˜ è±¡å¤šå€‹æ¨™ç±¤

æ³¨æ„ä¸Šé¢çš„ `ubuntu:24.04` å’Œ `ubuntu:noble` æ“æœ‰ç›¸åŒçš„ IMAGE IDâ€”â€”å®ƒå€‘æ˜¯åŒä¸€å€‹æ˜ è±¡çš„ä¸åŒæ¨™ç±¤ï¼Œåªä½”ç”¨ä¸€ä»½å„²å­˜ç©ºé–“ã€‚

---

### ç†è§£æ˜ è±¡å¤§å°

Docker æ˜ è±¡çš„å¤§å°å¯èƒ½èˆ‡æˆ‘å€‘é€šå¸¸ç†è§£çš„æª”æ¡ˆå¤§å°æœ‰æ‰€ä¸åŒï¼Œé€™æ¶‰åŠåˆ°åˆ†å±¤å„²å­˜çš„æ¦‚å¿µã€‚

#### æœ¬åœ°å¤§å° vs Hub é¡¯ç¤ºå¤§å°

| ä½ç½® | é¡¯ç¤ºå¤§å° | èªªæ˜ |
|------|---------|------|
| Docker Hub | 29MB | å£“ç¸®å¾Œçš„ç¶²è·¯å‚³è¼¸å¤§å° |
| docker image ls | 78MB | æœ¬åœ°è§£å£“å¾Œçš„å¯¦éš›å¤§å° |

#### å¯¦éš›ç£ç¢Ÿä½”ç”¨

ç”±æ–¼æ˜ è±¡æ˜¯åˆ†å±¤å„²å­˜ï¼Œä¸åŒæ˜ è±¡å¯èƒ½å…±äº«ç›¸åŒçš„å±¤ï¼š

```
ubuntu:24.04    nginx:latest    redis:latest
    â”‚               â”‚                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
            â–¼                        â”‚
       å…±äº«åŸºç¤å±¤ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å› æ­¤ï¼Œ`docker image ls` ä¸­å„æ˜ è±¡å¤§å°ä¹‹å’Œ > å¯¦éš›ç£ç¢Ÿä½”ç”¨ã€‚

#### æª¢è¦–å¯¦éš›ç©ºé–“ä½”ç”¨

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker system df
TYPE            TOTAL   ACTIVE   SIZE      RECLAIMABLE
Images          15      3        2.5GB     1.8GB (72%)
Containers      5       2        100MB     80MB (80%)
Local Volumes   8       2        500MB     400MB (80%)
Build Cache     0       0        0B        0B
```

---

### éæ¿¾æ˜ è±¡

éš¨è‘—æœ¬åœ°æ˜ è±¡æ•¸é‡çš„å¢åŠ ï¼Œæˆ‘å€‘éœ€è¦æ›´æœ‰æ•ˆçš„æ–¹å¼ä¾†æŸ¥è©¢ç‰¹å®šçš„æ˜ è±¡ã€‚Docker æä¾›äº†å¤šç¨®éæ¿¾æ–¹å¼ã€‚

#### æŒ‰å€‰åº«åéæ¿¾

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆ—å‡ºæ‰€æœ‰ ubuntu æ˜ è±¡

$ docker images ubuntu
REPOSITORY   TAG     IMAGE ID       SIZE
ubuntu       24.04   329ed837d508   78MB
ubuntu       noble   329ed837d508   78MB
ubuntu       22.04   a1b2c3d4e5f6   72MB
```

#### æŒ‰å€‰åº«åå’Œæ¨™ç±¤éæ¿¾

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images ubuntu:24.04
REPOSITORY   TAG     IMAGE ID       SIZE
ubuntu       24.04   329ed837d508   78MB
```

#### ä½¿ç”¨éæ¿¾å™¨ --filter

| éæ¿¾æ¢ä»¶ | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|
| `dangling=true` | è™›æ‡¸æ˜ è±¡ | `-f dangling=true` |
| `before=æ˜ è±¡` | åœ¨æŸæ˜ è±¡ä¹‹å‰å»ºç«‹ | `-f before=nginx:latest` |
| `since=æ˜ è±¡` | åœ¨æŸæ˜ è±¡ä¹‹å¾Œå»ºç«‹ | `-f since=nginx:latest` |
| `label=key=value` | æŒ‰ LABEL éæ¿¾ | `-f label=version=1.0` |
| `reference=pattern` | æŒ‰åç¨±æ¨¡å¼ | `-f reference='*:latest'` |

```bash
## åˆ—å‡º nginx ä¹‹å¾Œå»ºç«‹çš„æ˜ è±¡

$ docker images -f since=nginx:latest

## åˆ—å‡ºæ‰€æœ‰å¸¶ latest æ¨™ç±¤çš„æ˜ è±¡

$ docker images -f reference='*:latest'

## åˆ—å‡ºå¸¶ç‰¹å®š LABEL çš„æ˜ è±¡

$ docker images -f label=maintainer=example@email.com
```

---

### è™›æ‡¸æ˜ è±¡ï¼ˆDangling Imagesï¼‰

åœ¨æ˜ è±¡æ¸…å–®è£¡ï¼Œä½ å¯èƒ½æœƒçœ‹åˆ°ä¸€äº›å€‰åº«åå’Œæ¨™ç±¤éƒ½ç‚º `<none>` çš„æ˜ è±¡ï¼Œé€™é¡æ˜ è±¡è¢«ç¨±ç‚ºè™›æ‡¸æ˜ è±¡ã€‚

#### ä»€éº¼æ˜¯è™›æ‡¸æ˜ è±¡

å€‰åº«åå’Œæ¨™ç±¤éƒ½é¡¯ç¤ºç‚º `<none>` çš„æ˜ è±¡ï¼š

```bash
$ docker images
REPOSITORY   TAG       IMAGE ID       SIZE
<none>       <none>    00285df0df87   342MB
```

#### ç”¢ç”ŸåŸå› 

1. **æ˜ è±¡é‡æ–°å»ºç«‹**ï¼šæ–°æ˜ è±¡ä½¿ç”¨äº†èˆŠæ˜ è±¡çš„æ¨™ç±¤ï¼ŒèˆŠæ˜ è±¡æ¨™ç±¤è¢«ç§»é™¤
2. **docker pull æ›´æ–°**ï¼šæ‹‰å–æ›´æ–°ç‰ˆæœ¬æ™‚ï¼ŒèˆŠç‰ˆæœ¬å¤±å»æ¨™ç±¤

#### è™•ç†è™›æ‡¸æ˜ è±¡

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆ—å‡ºè™›æ‡¸æ˜ è±¡

$ docker images -f dangling=true

## åˆªé™¤è™›æ‡¸æ˜ è±¡

$ docker image prune
```

---

### ä¸­é–“å±¤æ˜ è±¡

é™¤äº†è™›æ‡¸æ˜ è±¡ï¼Œ`docker image ls` é è¨­åˆ—å‡ºçš„åªæ˜¯é ‚å±¤æ˜ è±¡ã€‚é‚„æœ‰ä¸€ç¨®æ˜ è±¡æ˜¯ç‚ºäº†åŠ é€Ÿæ˜ è±¡å»ºç«‹ã€é‡è¤‡åˆ©ç”¨è³‡æºè€Œå­˜åœ¨çš„ä¸­é–“å±¤æ˜ è±¡ã€‚

#### æª¢è¦–æ‰€æœ‰æ˜ è±¡ï¼ˆåŒ…å«ä¸­é–“å±¤ï¼‰

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images -a
```

æœƒé¡¯ç¤ºå¾ˆå¤šç„¡æ¨™ç±¤æ˜ è±¡â€”â€”é€™äº›æ˜¯å»ºç«‹éç¨‹ä¸­ç”¢ç”Ÿçš„ä¸­é–“å±¤ï¼Œè¢«å…¶ä»–æ˜ è±¡ä¾è³´ã€‚

> âš ï¸ ä¸è¦åˆªé™¤ä¸­é–“å±¤æ˜ è±¡ã€‚å®ƒå€‘æ˜¯å…¶ä»–æ˜ è±¡çš„ä¾è³´ï¼Œåˆªé™¤æœƒå°è‡´ä¸Šå±¤æ˜ è±¡ç„¡æ³•ä½¿ç”¨ã€‚åˆªé™¤é ‚å±¤æ˜ è±¡æ™‚æœƒè‡ªå‹•æ¸…ç†ä¸å†éœ€è¦çš„ä¸­é–“å±¤ã€‚

---

### æ ¼å¼åŒ–è¼¸å‡º

ç‚ºäº†é…åˆæŒ‡ä»¤ç¢¼ä½¿ç”¨æˆ–å±•ç¤ºæ›´é—œæ³¨çš„è¨Šæ¯ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ `--format` å¼•æ•¸ä¾†è‡ªå®šç¾©è¼¸å‡ºæ ¼å¼ã€‚

#### åªè¼¸å‡º ID

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images -q
5f515359c7f8
05a60462f8ba
329ed837d508
```

å¸¸ç”¨æ–¼é…åˆå…¶ä»–æŒ‡ä»¤ï¼š

```bash
## åˆªé™¤æ‰€æœ‰æ˜ è±¡

$ docker rmi $(docker images -q)

## åˆªé™¤æ‰€æœ‰ redis æ˜ è±¡

$ docker rmi $(docker images -q redis)
```

#### é¡¯ç¤ºå®Œæ•´ ID

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images --no-trunc
```

#### é¡¯ç¤ºæ‘˜è¦

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images --digests
REPOSITORY   TAG     DIGEST                    IMAGE ID
nginx        latest  sha256:b4f0e0bdeb5...    e43d811ce2f4
```

#### è‡ªå®šç¾©æ ¼å¼

ä½¿ç”¨ Go æ¨£æ¿èªæ³•è‡ªå®šç¾©è¼¸å‡ºï¼š

```bash
## åªé¡¯ç¤º ID å’Œå€‰åº«å

$ docker images --format "{{.ID}}: {{.Repository}}"
5f515359c7f8: redis
05a60462f8ba: nginx
329ed837d508: ubuntu

## è¡¨æ ¼å½¢å¼ï¼ˆå¸¶æ¨™é¡Œï¼‰

$ docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}"
REPOSITORY   TAG       SIZE
redis        latest    183MB
nginx        latest    181MB
ubuntu       24.04     78MB
```

#### å¯ç”¨æ¨£æ¿æ¬„ä½

| æ¬„ä½ | èªªæ˜ |
|------|------|
| `.ID` | æ˜ è±¡ ID |
| `.Repository` | å€‰åº«å |
| `.Tag` | æ¨™ç±¤ |
| `.Digest` | æ‘˜è¦ |
| `.CreatedSince` | å»ºç«‹å¾Œç¶“éçš„æ™‚é–“ |
| `.CreatedAt` | å»ºç«‹æ™‚é–“ |
| `.Size` | å¤§å° |

---

### å¸¸ç”¨æŒ‡ä»¤çµ„åˆ

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## åˆ—å‡ºæ‰€æœ‰æ˜ è±¡åŠå…¶å¤§å°ï¼ŒæŒ‰å¤§å°æ’åºï¼ˆéœ€è¦ç³»çµ± sort æŒ‡ä»¤ï¼‰

$ docker images --format "{{.Size}}\t{{.Repository}}:{{.Tag}}" | sort -h

## æŸ¥è©¢å¤§æ–¼ 500MB çš„æ˜ è±¡

$ docker images --format "{{.Size}}\t{{.Repository}}:{{.Tag}}" | grep -E "^[0-9]+GB|^[5-9][0-9]{2}MB"

## åŒ¯å‡ºæ˜ è±¡æ¸…å–®

$ docker images --format "{{.Repository}}:{{.Tag}}" > images.txt
```

---

### æœ¬ç« å°çµ

| æ“ä½œ | æŒ‡ä»¤ |
|------|------|
| åˆ—å‡ºæ‰€æœ‰æ˜ è±¡ | `docker images` |
| æŒ‰å€‰åº«åéæ¿¾ | `docker images nginx` |
| åˆ—å‡ºè™›æ‡¸æ˜ è±¡ | `docker images -f dangling=true` |
| åªè¼¸å‡º ID | `docker images -q` |
| é¡¯ç¤ºæ‘˜è¦ | `docker images --digests` |
| è‡ªå®šç¾©æ ¼å¼ | `docker images --format "..."` |
| æª¢è¦–ç©ºé–“ä½”ç”¨ | `docker system df` |

### å»¶ä¼¸é–±è®€

- [ç²å–æ˜ è±¡](4.1_pull.md)ï¼šå¾ Registry æ‹‰å–æ˜ è±¡
- [åˆªé™¤æ˜ è±¡](4.3_rm.md)ï¼šæ¸…ç†æœ¬åœ°æ˜ è±¡
- [æ˜ è±¡](../02_basic_concept/2.1_image.md)ï¼šç†è§£æ˜ è±¡æ¦‚å¿µ
