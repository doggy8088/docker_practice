## 4.1 ç²å–æ˜ è±¡

å¾ Docker æ˜ è±¡å€‰åº«ç²å–æ˜ è±¡å¯è¬‚æ˜¯ Docker é‹ä½œçš„ç¬¬ä¸€æ­¥ã€‚æœ¬ç¯€å°‡ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ `docker pull` æŒ‡ä»¤ä¸‹è¼‰æ˜ è±¡ï¼Œä»¥åŠå¦‚ä½•ç†è§£ä¸‹è¼‰éç¨‹ã€‚

### docker pull æŒ‡ä»¤

å¾æ˜ è±¡å€‰åº«ç²å–æ˜ è±¡çš„æŒ‡ä»¤æ˜¯ `docker pull`ï¼š

```bash
docker pull [é¸é …] [Registryåœ°å€/]å€‰åº«å[:æ¨™ç±¤]
```

#### æ˜ è±¡åç¨±æ ¼å¼

Docker æ˜ è±¡åç¨±ç”± Registry åœ°å€ã€ä½¿ç”¨è€…åã€å€‰åº«åå’Œæ¨™ç±¤çµ„æˆã€‚å…¶æ¨™æº–æ ¼å¼å¦‚ä¸‹ï¼š

```bash
docker.io / library / ubuntu : 24.04
â”€â”€â”€â”€â”¬â”€â”€â”€â”€   â”€â”€â”€â”¬â”€â”€â”€   â”€â”€â”¬â”€â”€â”€   â”€â”€â”¬â”€â”€
    â”‚         â”‚        â”‚        â”‚
Registryåœ°å€  ä½¿ç”¨è€…å    å€‰åº«å    æ¨™ç±¤
 (å¯çœç•¥)    (å¯çœç•¥)
```

| çµ„æˆéƒ¨åˆ† | èªªæ˜ | é è¨­å€¼ |
|---------|------|--------|
| Registry åœ°å€ | æ˜ è±¡å€‰åº«åœ°å€ | `docker.io` (Docker Hub)|
| ä½¿ç”¨è€…å | æ˜ è±¡æ‰€å±¬ä½¿ç”¨è€…/çµ„ç¹” | `library` (å®˜æ–¹æ˜ è±¡)|
| å€‰åº«å | æ˜ è±¡åç¨± | å¿…é ˆæŒ‡å®š |
| æ¨™ç±¤ | ç‰ˆæœ¬æ¨™è­˜ | `latest` |

#### ç¯„ä¾‹

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## å®Œæ•´æ ¼å¼

$ docker pull docker.io/library/ubuntu:24.04

## çœç•¥ Registryï¼ˆé è¨­ Docker Hubï¼‰

$ docker pull library/ubuntu:24.04

## çœç•¥ libraryï¼ˆå®˜æ–¹æ˜ è±¡ï¼‰

$ docker pull ubuntu:24.04

## çœç•¥æ¨™ç±¤ï¼ˆé è¨­ latestï¼‰

$ docker pull ubuntu

## æ‹‰å–ç¬¬ä¸‰æ–¹æ˜ è±¡

$ docker pull bitnami/redis:latest

## å¾å…¶ä»– Registry æ‹‰å–

$ docker pull ghcr.io/username/myapp:v1.0
```

---

### ä¸‹è¼‰éç¨‹è§£æ

ç•¶æˆ‘å€‘åŸ·è¡Œ `docker pull` æŒ‡ä»¤æ™‚ï¼ŒDocker æœƒè¼¸å‡ºè©³ç´°çš„ä¸‹è¼‰é€²åº¦ã€‚è®“æˆ‘å€‘ä»¥ `ubuntu:24.04` ç‚ºä¾‹ä¾†è§£æé€™äº›è¨Šæ¯ã€‚

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker pull ubuntu:24.04
24.04: Pulling from library/ubuntu
92dc2a97ff99: Pull complete
be13a9d27eb8: Pull complete
c8299583700a: Pull complete
Digest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26
Status: Downloaded newer image for ubuntu:24.04
docker.io/library/ubuntu:24.04
```

#### è¼¸å‡ºè§£è®€

ç›¸é—œè¨Šæ¯å¦‚ä¸‹è¡¨ï¼š

| è¼¸å‡ºå…§å®¹ | èªªæ˜ |
|---------|------|
| `Pulling from library/ubuntu` | æ­£åœ¨å¾å®˜æ–¹ ubuntu å€‰åº«æ‹‰å– |
| `92dc2a97ff99: Pull complete` | å„å±¤çš„ä¸‹è¼‰ç‹€æ…‹ (é¡¯ç¤ºå±¤ ID å‰ 12 ä½)|
| `Digest: sha256:...` | æ˜ è±¡å…§å®¹çš„å”¯ä¸€æ‘˜è¦ |
| `docker.io/library/ubuntu:24.04` | æ˜ è±¡çš„å®Œæ•´åç¨± |

#### åˆ†å±¤ä¸‹è¼‰

å¾è¼¸å‡ºå¯ä»¥çœ‹åˆ°ï¼Œæ˜ è±¡æ˜¯ **åˆ†å±¤ä¸‹è¼‰** çš„ï¼š

```mermaid
flowchart TD
    subgraph Image ["ubuntu:24.04 æ˜ è±¡"]
        direction TB
        L3["ç¬¬3å±¤ c8299583700a<br/>(å·²å­˜åœ¨ï¼Œè·³éä¸‹è¼‰)"]
        L2["ç¬¬2å±¤ be13a9d27eb8<br/>(ä¸‹è¼‰ä¸­... å®Œæˆ)"]
        L1["ç¬¬1å±¤ 92dc2a97ff99<br/>(ä¸‹è¼‰ä¸­... å®Œæˆ)"]
        L3 --- L2 --- L1
    end
```

å¦‚æœæœ¬åœ°å·²æœ‰ç›¸åŒçš„å±¤ï¼ŒDocker æœƒè·³éä¸‹è¼‰ï¼Œç¯€çœé »å¯¬å’Œæ™‚é–“ã€‚

---

### å¸¸ç”¨é¸é …

`docker pull` æŒ‡ä»¤æ”¯æ´å¤šç¨®é¸é …ä¾†æ»¿è¶³ä¸åŒçš„ä¸‹è¼‰éœ€æ±‚ï¼Œä¾‹å¦‚ä¸‹è¼‰æ‰€æœ‰æ¨™ç±¤ã€æŒ‡å®šå¹³å°æ¶æ§‹ç­‰ã€‚

| é¸é … | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `--all-tags, -a` | æ‹‰å–æ‰€æœ‰æ¨™ç±¤ | `docker pull -a ubuntu` |
| `--platform` | æŒ‡å®šå¹³å°æ¶æ§‹ | `docker pull --platform linux/arm64 nginx` |
| `--quiet, -q` | éœé»˜æ¨¡å¼ | `docker pull -q nginx` |

#### æ¦‚è¿°

ç¸½é«”æ¦‚è¿°äº†ä»¥ä¸‹å…§å®¹ã€‚

#### æŒ‡å®šå¹³å°

åœ¨ Apple Silicon Mac ä¸Šæ‹‰å– x86 æ˜ è±¡ï¼š

```bash
$ docker pull --platform linux/amd64 nginx
```

---

### æ‹‰å–å¾ŒåŸ·è¡Œ

æ‹‰å–æ˜ è±¡å¾Œï¼Œå¯ä»¥åŸºæ–¼å®ƒå•Ÿå‹•å®¹å™¨ï¼š

```bash
## æ‹‰å–æ˜ è±¡

$ docker pull ubuntu:24.04

## åŸ·è¡Œå®¹å™¨

$ docker run -it --rm ubuntu:24.04 bash
root@e7009c6ce357:/# cat /etc/os-release
PRETTY_NAME="Ubuntu 24.04 LTS"
...
root@e7009c6ce357:/# exit
```

**å¼•æ•¸èªªæ˜**ï¼š

| å¼•æ•¸ | èªªæ˜ |
|------|------|
| `-it` | äº’å‹•å¼çµ‚ç«¯æ¨¡å¼ |
| `--rm` | é€€å‡ºå¾Œè‡ªå‹•åˆªé™¤å®¹å™¨ |
| `bash` | å•Ÿå‹•æŒ‡ä»¤ |

> ğŸ’¡ `docker run` åœ¨éœ€è¦æ™‚æœƒè‡ªå‹• `pull` æ˜ è±¡ï¼Œå› æ­¤é€šå¸¸ä¸éœ€è¦å–®ç¨åŸ·è¡Œ `docker pull`ã€‚

---

### æ˜ è±¡åŠ é€Ÿ

å¾ Docker Hub ä¸‹è¼‰å¯èƒ½è¼ƒæ…¢ã€‚å¯ä»¥è¨­å®šæ˜ è±¡åŠ é€Ÿå™¨ï¼š

```json
// /etc/docker/daemon.json (Linux)
// ~/.docker/daemon.json (Docker Desktop)
{
  "registry-mirrors": [
    "https://your-accelerator-url"
  ]
}
```

è¨­å®šå¾Œé‡å•Ÿ Dockerï¼š

```bash
$ sudo systemctl restart docker  # Linux
## æˆ–åœ¨ Docker Desktop ä¸­é‡å•Ÿ

## æˆ–åœ¨ Docker Desktop ä¸­é‡å•Ÿ

```

è©³è¦‹[æ˜ è±¡åŠ é€Ÿå™¨](../03_install/3.9_mirror.md)ç« ç¯€ã€‚

---

### é©—è­‰æ˜ è±¡å®Œæ•´æ€§

ç‚ºäº†ç¢ºä¿ä¸‹è¼‰çš„æ˜ è±¡æ²’æœ‰è¢«ç¯¡æ”¹ä¸”å…§å®¹ä¸€è‡´ï¼Œæˆ‘å€‘å¯ä»¥æ ¡é©—æ˜ è±¡çš„æ‘˜è¦ (Digest)ã€‚

#### æª¢è¦–æ˜ è±¡æ‘˜è¦

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
$ docker images --digests ubuntu
REPOSITORY   TAG     DIGEST                                                                    IMAGE ID
ubuntu       24.04   sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26   ca2b0f26964c
```

#### ä½¿ç”¨æ‘˜è¦æ‹‰å–

ç”¨æ‘˜è¦æ‹‰å–å¯ç¢ºä¿ç²å–å®Œå…¨ç›¸åŒçš„æ˜ è±¡ï¼š

```bash
$ docker pull ubuntu@sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26
```

> ç­†è€…å»ºè­°ï¼šç”Ÿç”¢ç’°å¢ƒä½¿ç”¨æ‘˜è¦è€Œéæ¨™ç±¤ï¼Œå› ç‚ºæ¨™ç±¤å¯èƒ½è¢«è¦†è“‹ï¼Œæ‘˜è¦å‰‡æ˜¯ä¸å¯è®Šçš„ã€‚

---

### å¸¸è¦‹å•é¡Œ

åœ¨ä½¿ç”¨ `docker pull` éç¨‹ä¸­ï¼Œå¯èƒ½æœƒé‡åˆ°ä¸‹è¼‰é€Ÿåº¦æ…¢ã€æ˜ è±¡ä¸å­˜åœ¨æˆ–ç£ç¢Ÿç©ºé–“ä¸è¶³ç­‰å•é¡Œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è¦‹å•é¡Œçš„æ’æŸ¥æ€è·¯ã€‚

#### Qï¼šä¸‹è¼‰é€Ÿåº¦å¾ˆæ…¢

1. è¨­å®šæ˜ è±¡åŠ é€Ÿå™¨
2. æª¢æŸ¥ç¶²è·¯é€£ç·š
3. å˜—è©¦æ‹‰å–æ›´å°çš„æ˜ è±¡ç‰ˆæœ¬ (å¦‚ `alpine` è®Šé«”)

#### Qï¼šæç¤ºæ˜ è±¡ä¸å­˜åœ¨

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
Error: pull access denied, repository does not exist
```

å¯èƒ½åŸå› ï¼š

- æ˜ è±¡åæ‹¼å¯«éŒ¯èª¤
- ç§æœ‰æ˜ è±¡æœªç™»å…¥ (éœ€è¦ `docker login`)
- æ˜ è±¡ç¢ºå¯¦ä¸å­˜åœ¨

#### Qï¼šç£ç¢Ÿç©ºé–“ä¸è¶³

åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

```bash
## æ¸…ç†æœªä½¿ç”¨çš„æ˜ è±¡

$ docker image prune

## æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨è³‡æº

$ docker system prune
```

---
